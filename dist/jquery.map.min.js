!function(t){var e=function(e,n){this.mapWrapper=t(e),this.mapObj=null,this.map=null,this.defaults={locked:!1,htmlMarkers:!1,hideHtmlMarkers:!0,lat:0,lng:0,zoom:0,styles:[],markers:[],classes:{states:{active:"is-active"}}},this.markers=[],this.markersContainer=this.mapWrapper.find(".markers"),this.classes=t.extend(!0,this.defaults.classes,window.project?window.project.classes:{}),this.labels=t.extend(!0,this.defaults.labels,window.project?window.project.labels:{}),this.config=t.extend(!0,this.defaults,n||{}),this.init()};t.extend(e.prototype,{init:function(){window.googleAPI||this.loadAPI(),t(window).on("googleAPI",t.proxy(this.callback,this))},loadAPI:function(){window.googleAPI=!0,t.getScript("https://www.google.com/jsapi",t.proxy(function(){window.google.maps||google.load("maps","3",{other_params:"sensor=false",callback:t.proxy(function(){t(window).trigger("googleAPI")},this)})},this))},callback:function(){this.createMap()},createMap:function(){this.mapWrapper.append('<div class="map-inner-wrapper"></div>'),this.$mapObj=this.mapWrapper.find(".map-inner-wrapper"),this.mapObj=this.$mapObj.get(0),this.$mapObj.css("height","100%"),this.bounds=new window.google.maps.LatLngBounds,this.map=new window.google.maps.Map(this.mapObj,{mapTypeId:"roadmap",disableDefaultUI:!0,center:new window.google.maps.LatLng(this.config.lat,this.config.lng),zoom:this.config.zoom,styles:this.config.styles}),this.bindMapEvents(),this.addMarkersJs(),1==this.config.htmlMarkers&&this.addMarkersHTML(),1==this.config.locked&&this.lockMap()},addMarkersJs:function(){var e=this.config.markers.length;_.each(this.config.markers,t.proxy(function(t){t.position=new window.google.maps.LatLng(t.lat,t.lng),this.addMarker(t),e>1&&(this.bounds.extend(position),this.map.fitBounds(this.bounds))},this))},addMarkersHTML:function(){var e=this.mapWrapper.find(".markers"),n=(this.mapWrapper.find(".markers > .marker").length,this.mapWrapper.find(".marker"));this.bindHtmlMarkerEvents(n),1==this.config.hideHtmlMarkers&&e.hide(),_.each(n,t.proxy(function(e){var n={},i=t(e);n.position=new window.google.maps.LatLng(i.attr("data-lat"),i.attr("data-lng")),""!=i.attr("data-icon")?n.icon=i.attr("data-icon"):n.icon=this.markersContainer.attr("data-icon"),""!=i.attr("data-icon-hover")?n.iconHover=i.attr("data-icon-hover"):n.iconHover=this.markersContainer.attr("data-icon-hover"),n.title=i.attr("data-title"),n.id=i.attr("data-id"),n.infoWindowContent=i.html(),this.addMarker(n),length>1&&(this.bounds.extend(position),this.map.fitBounds(this.bounds))},this))},addMarker:function(t){var e="",n=new window.google.maps.Marker({position:t.position,map:this.map,icon:t.icon,iconDefault:t.icon,iconHover:t.iconHover,title:t.title,customId:t.id});this.markers[t.id]=n,this.bindMapsMarkerEvents(n),""!=t.infoWindowContent&&null!=t.infoWindowContent&&(e=new google.maps.InfoWindow({content:t.infoWindowContent}),this.bindInfoWindowEvent(n,e))},bindInfoWindowEvent:function(t,e){t.addListener("click",function(){e.open(this.map,t)})},bindMapEvents:function(){window.google.maps.event.addDomListener(window,"resize",t.proxy(function(){var t=this.map.getCenter();window.google.maps.event.trigger(this.map,"resize"),this.map.setCenter(t)},this))},bindHtmlMarkerEvents:function(e){e.on("mouseenter",t.proxy(function(e){$element=t(e.currentTarget),this.changeMarkerIcon($element,"hover")},this)),e.on("mouseleave",t.proxy(function(e){$element=t(e.currentTarget),this.changeMarkerIcon($element,"default")},this))},bindMapsMarkerEvents:function(e){var n=t('[data-id="'+e.customId+'"]');google.maps.event.addListener(e,"mouseover",t.proxy(function(){n.addClass(this.classes.states.active),this.changeMarkerIcon(n,"hover")},this)),google.maps.event.addListener(e,"mouseout",t.proxy(function(){n.removeClass(this.classes.states.active),this.changeMarkerIcon(n,"default")},this))},changeMarkerIcon:function(t,e){var n=this.markers[t.attr("data-id")],i=n.iconDefault;console.log(n),"hover"===e&&(i=n.iconHover),console.log(i),""!=i&&n.setIcon(i)},lockMap:function(){this.$mapObj.css("pointer-events","none"),this.bindLockMapEvents()},bindLockMapEvents:function(){this.mapWrapper.on("click",t.proxy(function(){this.mapWrapper.addClass(this.classes.states.active),this.$mapObj.css("pointer-events","auto")},this)),this.mapWrapper.on("mouseleave",t.proxy(function(){this.mapWrapper.removeClass(this.classes.states.active),this.$mapObj.css("pointer-events","none")},this))}}),t.fn.map=function(n){return this.each(function(){var i=t(this);if(!i.data("map")){var a=new e(this,n);i.data("map",a)}})}}(jQuery);