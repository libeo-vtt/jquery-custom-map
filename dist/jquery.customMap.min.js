!function(t){var i=function(i,a){this.mapWrapper=t(i),this.mapObj=null,this.map=null,this.defaults={locked:!1,htmlMarkers:!1,hideHtmlMarkers:!0,lat:0,lng:0,zoom:0,styles:[],markers:[],classes:{mapInnerWrapper:"",states:{active:"is-active"}}},this.map=null,this.markers=[],this.infoWindows=[],this.markersContainer=this.mapWrapper.find(".markers"),this.classes=t.extend(!0,this.defaults.classes,window.project?window.project.classes:{}),this.labels=t.extend(!0,this.defaults.labels,window.project?window.project.labels:{}),this.config=t.extend(!0,this.defaults,a||{}),this.publicMethods={refreshMap:t.proxy(function(){this.refreshMap()},this)},this.init()};t.extend(i.prototype,{init:function(){window.googleAPI||this.loadAPI(),t(window).on("googleAPI",t.proxy(this.callback,this))},loadAPI:function(){window.googleAPI=!0,t.getScript("https://www.google.com/jsapi",t.proxy(function(){window.google.maps||google.load("maps","3",{other_params:"sensor=false",callback:t.proxy(function(){t(window).trigger("googleAPI")},this)})},this))},callback:function(){this.createMap()},createMap:function(){this.mapWrapper.append('<div class="map-inner-wrapper '+this.config.classes.mapInnerWrapper+'"></div>'),this.$mapObj=this.mapWrapper.find(".map-inner-wrapper"),this.mapObj=this.$mapObj.get(0),this.$mapObj.css("height","100%"),this.bounds=new window.google.maps.LatLngBounds,this.map=new window.google.maps.Map(this.mapObj,{mapTypeId:"roadmap",disableDefaultUI:!0,center:new window.google.maps.LatLng(this.config.lat,this.config.lng),zoom:this.config.zoom,styles:this.config.styles}),this.bindMapEvents(),this.addMarkersJs(),1==this.config.htmlMarkers&&this.addMarkersHTML(),1==this.config.locked&&this.lockMap()},addMarkersJs:function(){var i=this.config.markers.length;_.each(this.config.markers,t.proxy(function(t){t.position=new window.google.maps.LatLng(t.lat,t.lng),this.addMarker(t),i>1&&(this.bounds.extend(position),this.map.fitBounds(this.bounds))},this))},addMarkersHTML:function(){var i=this.mapWrapper.find(".markers"),a=(this.mapWrapper.find(".markers > .marker").length,this.mapWrapper.find(".marker"));this.bindHtmlMarkerEvents(a),1==this.config.hideHtmlMarkers&&i.hide(),_.each(a,t.proxy(function(i){var a={},e=t(i);a.position=new window.google.maps.LatLng(e.attr("data-lat"),e.attr("data-lng")),""!=e.attr("data-icon")&&void 0!=e.attr("data-icon")?a.icon=e.attr("data-icon"):""!=this.markersContainer.attr("data-icon")&&void 0!=this.markersContainer.attr("data-icon")?a.icon=this.markersContainer.attr("data-icon"):a.icon="",""!=e.attr("data-icon-hover")&&void 0!=e.attr("data-icon-hover")?a.iconHover=e.attr("data-icon-hover"):""!=this.markersContainer.attr("data-icon-hover")&&void 0!=this.markersContainer.attr("data-icon-hover")?a.iconHover=this.markersContainer.attr("data-icon-hover"):a.iconHover="",""!=e.attr("data-icon-width")&&void 0!=e.attr("data-icon-width")?a.iconWidth=parseInt(e.attr("data-icon-width")):""!=this.markersContainer.attr("data-icon-width")&&void 0!=this.markersContainer.attr("data-icon-width")?a.iconWidth=parseInt(this.markersContainer.attr("data-icon-width")):a.iconWidth="",""!=e.attr("data-icon-height")&&void 0!=e.attr("data-icon-height")?a.iconHeight=parseInt(e.attr("data-icon-height")):""!=this.markersContainer.attr("data-icon-height")&&void 0!=this.markersContainer.attr("data-icon-height")?a.iconHeight=parseInt(this.markersContainer.attr("data-icon-height")):a.iconHeight="",a.title=e.attr("data-title"),a.id=e.attr("data-id"),a.infoWindowContent=e.find(".marker-popup-content").html(),this.addMarker(a),length>1&&(this.bounds.extend(position),this.map.fitBounds(this.bounds))},this))},addMarker:function(t){var i="",a=t.icon,e=t.iconHover;""!==t.iconWidth&&void 0!==t.iconWidth&&""!==t.iconHeight&&void 0!==t.iconHeight&&""!=t.icon&&void 0!=t.icon&&""!=t.iconHover&&void 0!=t.iconHover&&(a={url:t.icon,scaledSize:new google.maps.Size(t.iconWidth,t.iconHeight)},e={url:t.iconHover,scaledSize:new google.maps.Size(t.iconWidth,t.iconHeight)});var n=new window.google.maps.Marker({position:t.position,map:this.map,icon:a,iconDefault:a,iconHover:e,title:t.title,customId:t.id});this.markers[t.id]=n,this.bindMapsMarkerEvents(n),""!=t.infoWindowContent&&null!=t.infoWindowContent&&(i=new google.maps.InfoWindow({content:t.infoWindowContent}),this.infoWindows.push(i),this.bindInfoWindowEvent(n,i))},bindInfoWindowEvent:function(i,a){i.addListener("click",t.proxy(function(){_.each(this.infoWindows,t.proxy(function(t){t.close()},this)),_.each(this.markers,t.proxy(function(t){void 0!=t&&this.resetMarker(t)},this)),a.open(this.map,i),i.isClicked=!0,this.changeMarkerIcon(i,"hover"),t('[data-id="'+i.customId+'"]').addClass(this.config.classes.states.active)},this)),a.addListener("closeclick",t.proxy(function(){_.each(this.markers,t.proxy(function(t){void 0!=t&&this.resetMarker(t)},this))},this))},bindMapEvents:function(){window.google.maps.event.addDomListener(window,"resize",t.proxy(function(){var t=this.map.getCenter();window.google.maps.event.trigger(this.map,"resize"),this.map.setCenter(t)},this))},bindHtmlMarkerEvents:function(i){i.on("mouseenter",t.proxy(function(i){var a=this.markers[t(i.currentTarget).attr("data-id")];this.changeMarkerIcon(a,"hover")},this)),i.on("mouseleave",t.proxy(function(i){var a=this.markers[t(i.currentTarget).attr("data-id")];this.changeMarkerIcon(a,"default")},this))},bindMapsMarkerEvents:function(i){var a=t('[data-id="'+i.customId+'"]');google.maps.event.addListener(i,"mouseover",t.proxy(function(){a.addClass(this.classes.states.active),this.changeMarkerIcon(i,"hover")},this)),google.maps.event.addListener(i,"mouseout",t.proxy(function(){i.isClicked!==!0&&(a.removeClass(this.classes.states.active),this.changeMarkerIcon(i,"default"))},this))},changeMarkerIcon:function(t,i){var a=t.iconDefault;"hover"===i&&(a=t.iconHover),""!=a&&t.setIcon(a)},lockMap:function(){this.$mapObj.css("pointer-events","none"),this.bindLockMapEvents()},bindLockMapEvents:function(){this.mapWrapper.on("click",t.proxy(function(){this.mapWrapper.addClass(this.classes.states.active),this.$mapObj.css("pointer-events","auto")},this)),this.mapWrapper.on("mouseleave",t.proxy(function(){this.mapWrapper.removeClass(this.classes.states.active),this.$mapObj.css("pointer-events","none")},this))},refreshMap:function(){window.google.maps.event.trigger(this.map,"resize"),this.map.setCenter(new window.google.maps.LatLng(this.config.lat,this.config.lng))},resetMarker:function(i){i.isClicked=!1,this.changeMarkerIcon(i,"default"),t('[data-id="'+i.customId+'"]').removeClass(this.config.classes.states.active)}}),t.fn.customMap=function(a){return this.each(t.proxy(function(e,n){var o=t(n);if(!o.data("custom-map")){var s=new i(n,a);for(var r in s.publicMethods)this[r]=s.publicMethods[r];o.data("custom-map",s)}},this)),this}}(jQuery);